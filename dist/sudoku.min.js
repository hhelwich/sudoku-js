/*! Sudoku JS - v0.1.0-SNAPSHOT - 2013-01-12
* https://github.com/hhelwich/sudoku-js
* Copyright (c) 2013 Hendrik Helwich; Licensed GPLv3 */
var hhelwi=hhelwi||{};hhelwi.sudoku=function(){"use strict";var e,t,n=function(){var e=function(e,t,n,r){var i;this.size=e*t,this.rows=e,this.cols=t,this.symbols=n,this.length=this.size*this.size;if(r===undefined){r=[],r.length=this.length;for(i=this.length-1;i>=0;i-=1)r[i]=null}else r=r.slice();this.data=r};return e.prototype={getX:function(e,t){return this.data[t+e*this.size]},setX:function(e,t,n){if(n!==null&(n<0||n>=this.size))throw"invalid value "+n;this.data[t+e*this.size]=n},get:function(e,t){var n=this.getX(e,t);return n!==null&&this.symbols!==undefined&&(n=this.symbols.charAt(n)),n},set:function(e,t,n){n!==null&&this.symbols!==undefined&&(n=this.symbols.indexOf(n)),this.setX(e,t,n)},isEqual:function(e){var t;if(this===e)return!0;if(this.row!==e.row||this.cols!==e.cols)return!1;if(this.symbols!==e.symbols)return!1;for(t=this.length-1;t>=0;t-=1)if(this.data[t]!==e.data[t])return!1;return!0},clone:function(){return new n(this.rows,this.cols,this.symbols,this.data)},getBlockIndex:function(e,t){return e<0||e>=this.size||t<0||t>=this.size?undefined:~~(e/this.rows)*this.rows+~~(t/this.cols)},solve:function(e){return i(this).solve(e,{active:!1})},generate:function(){return i(this).solve(!0,{active:!0})},toString:function(){var e,t,n="",r;for(e=0;e<this.size;e+=1){for(t=0;t<this.size;t+=1)r=this.get(e,t),t>0&&(n+=" "),n+=r===null?"_":this.get(e,t);e<this.size-1&&(n+="\n")}return n}},e}(),r=function(e,t,r){return new n(e,t,r)},i=function(){var e=function(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24},n=function(e){var t;if(e===0)return-1;for(t=0;(e&1)===0;t+=1)e>>=1;return t},r=function(e){var t,n,r;for(t=e.length-1;t>0;t-=1)n=~~(Math.random()*(t+1)),r=e[t],e[t]=e[n],e[n]=r;return e},i;return function(t){var n,i,s,o,u,a,f,l,c=function(e,r){var o,u,a,f,c,h;o=t.getBlockIndex(e,r),n[e]=l,i[r]=l,s[o]=l;for(a=0;a<t.size;a+=1)f=t.getX(e,a),f!==null&&(n[e]&=~(1<<f)),f=t.getX(a,r),f!==null&&(i[r]&=~(1<<f));c=~~(e/t.rows)*t.rows,h=~~(r/t.cols)*t.cols;for(u=0;u<t.rows;u+=1)for(a=0;a<t.cols;a+=1)f=t.getX(u+c,a+h),f!==null&&(s[o]&=~(1<<f))},h=function(e){var n=[],r;for(r=0;r<t.size;r+=1)(e&1<<r)!==0&&n.push(r);return n};if(t.size>63)throw"field is to big for this implementation";l=(1<<t.size)-1,n=[],n.length=t.size;for(o=t.size-1;o>=0;o-=1)n[o]=l;i=n.slice(),s=n.slice();for(o=t.size-1;o>=0;o-=1)for(u=t.size-1;u>=0;u-=1)f=t.getX(o,u),f!==null&&(a=t.getBlockIndex(o,u),f=~(1<<f),n[o]&=f,i[u]&=f,s[a]&=f);var p={set:function(e,r,o){var u=t.getX(e,r),a;o===null?u!==null&&(t.setX(e,r,null),c(e,r)):(t.setX(e,r,o),u===null?(a=t.getBlockIndex(e,r),o=~(1<<o),n[e]&=o,i[r]&=o,s[a]&=o):c(e,r))},getMinIndices:function(){var r,o,u,a,f,l=t.size+1,c=[];for(r=0;r<t.size;r+=1)for(o=0;o<t.size;o+=1)a=t.getX(r,o),a===null&&(u=t.getBlockIndex(r,o),a=n[r]&i[o]&s[u],f=e(a),f<=l&&(f<l&&(l=f,c.length=0),c.push({row:r,col:o,cand:a})));return c},solve:function(e,n){var i=this.getMinIndices(),s,o,u,a,f;if(i.length===0)return n.active&&(t.solution=t.clone()),!0;s=i[e?~~(Math.random()*i.length):0],i=null,a=h(s.cand),e&&r(a);for(o=0;o<a.length;o+=1){f=a[o],this.set(s.row,s.col,f);if(this.solve(e,n)){if(n.active){if(a.length>1){for(u=o+1;u<a.length;u+=1){this.set(s.row,s.col,a[u]);if(this.solve(e,{active:!1,clear:!0}))return this.set(s.row,s.col,f),!0}this.set(s.row,s.col,null)}this.set(s.row,s.col,null)}return n.clear&&this.set(s.row,s.col,null),!0}this.set(s.row,s.col,null)}return!1}};return p}}();return e={create:r},e}();