/*! Sudoku JS - v0.1.0-SNAPSHOT - 2013-01-06
* https://github.com/hhelwich/sudoku-js
* Copyright (c) 2013 Hendrik Helwich; Licensed GPLv3 */
var hhelwi=hhelwi||{};hhelwi.sudoku=function(){"use strict";var e,t,n=function(e){return e.get=function(e,t){return this[t+e*this.size]},e.set=function(e,t,n){if(n!==null&(n<0||n>=this.size))throw"invalid value "+n;this[t+e*this.size]=n},e.clone=function(){var e=this.slice();return e.size=this.size,e.rows=this.rows,e.cols=this.cols,n(e)},e.getBlockIndex=function(e,t){return e<0||e>=this.size||t<0||t>=this.size?undefined:~~(e/this.rows)*this.rows+~~(t/this.cols)},e.solve=function(){return i(this).solve(!1,{active:!1})},e.generate=function(){return i(this).solve(!0,{active:!0})},e},r=function(e,t){var r=[],i;r.length=e*t*e*t,r.size=e*t,r.rows=e,r.cols=t;for(i=r.length-1;i>=0;i-=1)r[i]=null;return n(r)},i=function(){var e=function(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24},n=function(e){var t;if(e===0)return-1;for(t=0;(e&1)===0;t+=1)e>>=1;return t},r=function(e){var t,n,r;for(t=e.length-1;t>0;t-=1)n=~~(Math.random()*(t+1)),r=e[t],e[t]=e[n],e[n]=r;return e},i;return function(t){var n,i,s,o,u,a,f,l,c=function(e,r){var o,u,a,f,c,h;o=t.getBlockIndex(e,r),n[e]=l,i[r]=l,s[o]=l;for(a=0;a<t.size;a+=1)f=t.get(e,a),f!==null&&(n[e]&=~(1<<f)),f=t.get(a,r),f!==null&&(i[r]&=~(1<<f));c=~~(e/t.rows)*t.rows,h=~~(r/t.cols)*t.cols;for(u=0;u<t.rows;u+=1)for(a=0;a<t.cols;a+=1)f=t.get(u+c,a+h),f!==null&&(s[o]&=~(1<<f))},h=function(e){var n=[],r;for(r=0;r<t.size;r+=1)(e&1<<r)!==0&&n.push(r);return n};if(t.size>63)throw"field is to big for this implementation";l=(1<<t.size)-1,n=[],n.length=t.size;for(o=t.size-1;o>=0;o-=1)n[o]=l;i=n.slice(),s=n.slice();for(o=t.size-1;o>=0;o-=1)for(u=t.size-1;u>=0;u-=1)f=t.get(o,u),f!==null&&(a=t.getBlockIndex(o,u),f=~(1<<f),n[o]&=f,i[u]&=f,s[a]&=f);return{set:function(e,r,o){var u=t.get(e,r),a;o===null?u!==null&&(t.set(e,r,null),c(e,r)):(t.set(e,r,o),u===null?(a=t.getBlockIndex(e,r),o=~(1<<o),n[e]&=o,i[r]&=o,s[a]&=o):c(e,r))},getMinIndices:function(){var r,o,u,a,f,l=t.size+1,c=[];for(r=0;r<t.size;r+=1)for(o=0;o<t.size;o+=1)a=t.get(r,o),a===null&&(u=t.getBlockIndex(r,o),a=n[r]&i[o]&s[u],f=e(a),f<=l&&(f<l&&(l=f,c.length=0),c.push({row:r,col:o,cand:a})));return c},solve:function(e,n){var i=this.getMinIndices(),s,o,u,a,f;if(i.length===0)return n.active&&(t.solution=t.clone()),!0;s=i[e?~~(Math.random()*i.length):0],i=null,a=h(s.cand),e&&r(a);for(o=0;o<a.length;o+=1){f=a[o],this.set(s.row,s.col,f);if(this.solve(e,n)){if(n.active){if(a.length>1){for(u=o+1;u<a.length;u+=1){this.set(s.row,s.col,a[u]);if(this.solve(e,{active:!1,clear:!0}))return this.set(s.row,s.col,f),!0}this.set(s.row,s.col,null)}this.set(s.row,s.col,null)}return n.clear&&this.set(s.row,s.col,null),!0}this.set(s.row,s.col,null)}return!1},getRowCandidates:function(e){return h(n[e])},getColCandidates:function(e){return h(i[e])},getBlockCandidates:function(e){return h(s[e])}}}}();return e={create:r},e}();