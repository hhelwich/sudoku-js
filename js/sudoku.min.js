/*! Sudoku JS - v0.1.0-SNAPSHOT - 2013-01-05
* https://github.com/hhelwich/sudoku-js
* Copyright (c) 2013 Hendrik Helwich; Licensed GPLv3 */
(function(e){"use strict";var t=function(e){return e.get=function(e,t){return this[t+e*this.size]},e.set=function(e,t,n){if(n<0||n>=this.size)throw"invalid value "+n;this[t+e*this.size]=n},e.clone=function(){var e=this.slice();return e.size=this.size,e.rows=this.rows,e.cols=this.cols,t(e)},e.getBlockIndex=function(e,t){return e<0||e>=this.size||t<0||t>=this.size?undefined:~~(e/this.rows)*this.rows+~~(t/this.cols)},e.solve=function(){return r(this).solve(!1,{active:!1})},e.generate=function(){return r(this).solve(!0,{active:!0})},e},n=function(e,n){var r=[],i;r.length=e*n*e*n,r.size=e*n,r.rows=e,r.cols=n;for(i=r.length-1;i>=0;i-=1)r[i]=null;return t(r)},r=function(){var e=function(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24},t=function(e){var t;if(e===0)return-1;for(t=0;(e&1)===0;e>>=1,t+=1);return t},n=function(e){var t,n,r,i=e.length;for(t=0;t<i-1;t+=1)n=~~(Math.random()*(i-1-t))+t+1,r=e[t],e[t]=e[n],e[n]=r;return e};return function(t){var r,i,s,o,u,a,f,l,c=function(e,n){var o,u,a,f,c,h;o=t.getBlockIndex(e,n),r[e]=l,i[n]=l,s[o]=l;for(a=0;a<t.size;a+=1)f=t.get(e,a),f!==null&&(r[e]&=~(1<<f)),f=t.get(a,n),f!==null&&(i[n]&=~(1<<f));c=~~(e/t.rows)*t.rows,h=~~(n/t.cols)*t.cols;for(u=0;u<t.rows;u+=1)for(a=0;a<t.cols;a+=1)f=t.get(u+c,a+h),f!==null&&(s[o]&=~(1<<f))},h=function(e){var n=[],r;for(r=0;r<t.size;r+=1)(e&1<<r)!==0&&n.push(r);return n};if(t.size>63)throw"field is to big for this implementation";l=(1<<t.size)-1,r=[],r.length=t.size;for(o=t.size-1;o>=0;o-=1)r[o]=l;i=r.slice(),s=r.slice();for(o=t.size-1;o>=0;o-=1)for(u=t.size-1;u>=0;u-=1)f=t.get(o,u),f!==null&&(a=t.getBlockIndex(o,u),f=~(1<<f),r[o]&=f,i[u]&=f,s[a]&=f);return{set:function(e,n,o){var u=t.get(e,n),a;o===null?u!==null&&(t.set(e,n,null),c(e,n)):(t.set(e,n,o),u===null?(a=t.getBlockIndex(e,n),o=~(1<<o),r[e]&=o,i[n]&=o,s[a]&=o):c(e,n))},getMinIndices:function(){var n,o,u,a,f,l=t.size+1,c=[];for(n=0;n<t.size;n+=1)for(o=0;o<t.size;o+=1)a=t.get(n,o),a===null&&(u=t.getBlockIndex(n,o),a=r[n]&i[o]&s[u],f=e(a),f<=l&&(f<l&&(l=f,c.length=0),c.push({row:n,col:o,cand:a})));return c},solve:function(e,r){var i=this.getMinIndices(),s,o,u,a,f;if(i.length===0)return r.active&&(t.solution=t.clone()),!0;s=i[e?~~(Math.random()*i.length):0],i=null,a=h(s.cand),e&&n(a);for(o=0;o<a.length;o+=1){f=a[o],this.set(s.row,s.col,f);if(this.solve(e,r)){if(r.active){if(a.length>1){for(u=o+1;u<a.length;u+=1){this.set(s.row,s.col,a[u]);if(this.solve(e,{active:!1,clear:!0}))return this.set(s.row,s.col,f),!0}this.set(s.row,s.col,null)}this.set(s.row,s.col,null)}return r.clear&&this.set(s.row,s.col,null),!0}this.set(s.row,s.col,null)}return!1},getRowCandidates:function(e){return h(r[e])},getColCandidates:function(e){return h(i[e])},getBlockCandidates:function(e){return h(s[e])}}}}();e.sudoku={createField:n,candidateTrackField:r}})(this);